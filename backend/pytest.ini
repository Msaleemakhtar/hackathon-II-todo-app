[pytest]
asyncio_mode = auto
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
pythonpath = .

# Test output and reporting
addopts =
    -v
    --strict-markers
    --tb=short
    --color=yes
    --maxfail=5
    --html=test-report.html
    --self-contained-html

# Coverage options (run with: pytest --cov=src --cov-report=html)
# Note: Coverage requires sqlite3 support in Python. If you get sqlite3 errors,
# run tests without coverage or use Python 3.11-3.13 instead of 3.14.

# Custom markers for test organization
markers =
    unit: Unit tests that test individual functions/classes in isolation
    integration: Integration tests that test multiple components working together
    api: API endpoint tests using the HTTP client
    db: Database-related tests
    auth: Authentication and authorization tests
    slow: Tests that take a long time to run
    reminders: Tests for reminder functionality
    analytics: Tests for analytics and metrics
    notifications: Tests for notification/subscription functionality
    smoke: Critical smoke tests that should always pass

# Coverage configuration
[coverage:run]
source = src
omit =
    */tests/*
    */__pycache__/*
    */site-packages/*
    */migrations/*
    */alembic/*

[coverage:report]
precision = 2
skip_covered = False
skip_empty = True
sort = Cover

# Filter out third-party library deprecation warnings
filterwarnings =
    # Ignore slowapi's use of deprecated asyncio.iscoroutinefunction
    ignore:.*asyncio\.iscoroutinefunction.*:DeprecationWarning:slowapi
    # Ignore pydantic's internal use of datetime.utcnow
    ignore:.*datetime\.datetime\.utcnow.*:DeprecationWarning:pydantic
    # Ignore httpx's per-request cookies deprecation (testing only)
    ignore:.*Setting per-request cookies.*:DeprecationWarning:httpx